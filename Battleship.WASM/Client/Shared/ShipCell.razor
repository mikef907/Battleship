
<div draggable="false" id="@X-@Y" class="game-grid-cell @dropClass"
     ondragover="event.preventDefault();"
     ondragstart="event.dataTransfer.setData('', event.target.id);"
     @ondrop="HandleDrop"
     @ondragenter="HandleDragEnter"
     @ondragleave="HandleDragLeave">
    @if (ShipModel is not null)
    {
        <ShipGamePiece ShipModel="ShipModel" />
    }
</div>

@code {
    [Parameter] public int X { get; set; }
    [Parameter] public int Y { get; set; }
    [Parameter] public IShip? ShipModel { get; set; }
    [Parameter] public EventCallback<Coordinate> OnDropUpdate { get; set; }
    [CascadingParameter] protected Gameboard gameboard { get; set; }

    private string? dropClass;

    private async void HandleDrop()
    {
        Console.WriteLine("drop");

        if (ShipModel is null || ShipModel == gameboard.CurrentSelected)
        {
            await OnDropUpdate.InvokeAsync(new Coordinate(X, Y));
        }

        dropClass = string.Empty;
    }

    private void HandleDragEnter()
    {
        if (ShipModel is null || ShipModel == gameboard.CurrentSelected)
        {
            dropClass = "can-drop";
        }
        else
        {
            dropClass = "no-drop";
        }
    }

    private void HandleDragLeave()
    {
        Console.WriteLine("Drag leave");
        dropClass = "";
    }
}
